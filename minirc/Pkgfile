# Description: Minimalistic init script. (git checkout)
# URL:         https://github.com/hut/minirc
# Packager:    onodera, onodera at openmailbox dot org
# Maintainer:  6c37 Team, https://github.com/6c37/crux-ports-git/issues
# Depends on:  busybox

name=minirc
version=git
release=1
source=()

build () {
	cd $PKGMK_SOURCE_DIR

	if cd $name; then
		git fetch -q; git reset --hard origin/master
	else
		git clone git://github.com/hut/minirc $name
		cd $name
	fi

	# Fix https://github.com/hut/minirc/issues/24
	sed -i "s/\/usr\/bin\/udevd/\/sbin\/udevd/g" rc
	sed -i "s/\/usr\/bin\/udevadm/\/sbin\/udevadm/g" rc
	sed -i "s/\/usr\/sbin/\/sbin/g" rc

	# Fix hostname
	sed -i "s/cat \/etc\/hostname/echo \$HOSTNAME/g" rc

	ROOT=$PKG ./setup.sh --force
}
