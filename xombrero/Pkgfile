# Description: A minimalist web browser (git checkout)
# URL:         https://github.com/conformal/xombrero
# Packager:    Luiz de Milon, kori at openmailbox dot org
# Maintainer:  6c37 Team, https://github.com/6c37/crux-ports-git/issues
# Depends on:  git libbsd desktop-file-utils webkitgtk

name=xombrero
version=git
release=1
source=()

build() {
	cd $PKGMK_SOURCE_DIR

	if cd $name; then
		git fetch -q; git reset --hard origin/master
	else
		git clone git://github.com/conformal/xombrero $name
		cd $name
	fi

	sed -i 's/gnutls/& libbsd/' Makefile
	sed -i 's|/usr/local|/usr|' xombrero.{h,conf}
	sed -i 's|LIBS= gtk+-2.0|& javascriptcoregtk-1.0|' Makefile
	sed -i 's|https://www.cyphertite.com|http://crux.nu|' xombrero.{c,conf,h}

	cd "linux"

	make GTK_VERSION=gtk2
	make PREFIX="/usr/" MANDIR="/usr/share/man" DESTDIR="$PKG" install 

	install -Dm644 ../xombrero.conf $PKG/etc/xombrero.conf
	install -Dm644 ../xombrero.desktop  $PKG/usr/share/applications/xombrero.desktop
	install -Dm755 ../config-checker.pl $PKG/usr/bin/xombrero-config-checker
}
